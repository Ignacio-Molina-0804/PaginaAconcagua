---
// src/components/Hero.astro

// Definición de las props que recibe el componente Hero
export interface Props {
  backgroundImage: string | string[]; // Imagen de fondo (ruta o array de rutas)
  title: string;                     // Título principal
  subtitle?: string;                 // Subtítulo opcional
  blurIntensity?: 'sm' | 'md' | 'lg';// Intensidad del desenfoque del fondo
  opacity?: number;                  // Opacidad del fondo (0-100)
  placeholderColor?: string;         // Color de fondo mientras carga la imagen
  loading?: 'eager' | 'lazy';        // Estrategia de carga de la imagen
  objectPosition?: string;           // Posición del objeto (ej: 'object-center', 'object-top')
}

// Desestructuración de props con valores por defecto
const { 
  backgroundImage, 
  title, 
  subtitle = '',
  blurIntensity = 'sm', 
  opacity = 40,
  placeholderColor = 'rgb(23 23 23)',
  loading = 'lazy',
  objectPosition = 'object-center'
} = Astro.props;

// Convertir backgroundImage a array siempre para facilitar el manejo
const images = Array.isArray(backgroundImage) ? backgroundImage : [backgroundImage];
const isSlideshow = images.length > 1;

// Clases de Tailwind para el desenfoque según la prop
const blurClasses = {
  sm: 'backdrop-blur-sm',
  md: 'backdrop-blur-md',
  lg: 'backdrop-blur-lg'
};

// Si la imagen debe cargarse "eager", se pre-carga con un script auxiliar
// Solo precargamos la primera imagen si es slideshow
if (loading === 'eager') {
  import('../scripts/preloadImage').then(({ preloadImage }) => preloadImage(images[0]));
}
---

<!-- 
  Sección principal del Hero.
  Usa una imagen de fondo (o varias en slideshow), un overlay oscuro y un bloque con título y subtítulo.
-->
<section 
  class="relative h-[70vh] sm:h-[80vh] md:h-[90vh] flex items-center justify-center overflow-hidden"
  style={`background-color: ${placeholderColor};`}
  id="hero-section"
  data-slideshow={isSlideshow}
  data-interval="5000" 
>
  <!-- Imágenes de fondo -->
  {
    images.map((img, index) => (
      <img
        src={img}
        alt=""
        aria-hidden="true"
        class={`absolute inset-0 w-full h-full object-cover ${objectPosition} transition-opacity duration-1000 ease-in-out ${index === 0 ? 'opacity-100 z-10' : 'opacity-0 z-0'}`}
        data-hero-image
        data-index={index}
        loading={index === 0 ? loading : 'lazy'}
        width="1920"
        height="1080"
        fetchpriority={index === 0 && loading === 'eager' ? 'high' : 'auto'}
        decoding="async"
      />
    ))
  }
  
  <!-- Overlay negro semitransparente para oscurecer la imagen -->
  <div class="absolute inset-0 bg-black/30 z-20 pointer-events-none"></div>
  
  <!-- Contenedor del título y subtítulo, con fondo desenfocado y opacidad -->
  <div 
    class={`relative z-30 text-center text-white px-6 py-8 sm:px-8 sm:py-10 md:px-10 md:py-12 rounded-lg border border-white/10 ${blurClasses[blurIntensity]} mx-4 sm:mx-6`}
    style={`background-color: rgb(0 0 0 / ${opacity}%);`}
  >
    <!-- Título principal -->
    <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold mb-3 md:mb-4 tracking-wider leading-tight">
      {title}
    </h1>
    <!-- Subtítulo, si existe -->
    {subtitle && (
      <p class="text-base sm:text-lg md:text-xl lg:text-2xl font-medium mt-2 sm:mt-3">
        {subtitle}
      </p>
    )}
  </div>
  
  <!-- Gradiente en la parte inferior para mejorar la legibilidad -->
  <div class="absolute bottom-0 left-0 right-0 h-1/3 bg-gradient-to-t from-black/70 via-black/40 to-transparent z-20 pointer-events-none"></div>
</section>

{isSlideshow && (
  <script>
    // Script para el slideshow
    const section = document.getElementById('hero-section');
    if (section && section.dataset.slideshow === 'true') {
      const images = section.querySelectorAll('[data-hero-image]');
      const intervalTime = parseInt(section.dataset.interval || '5000');
      let currentIndex = 0;

      if (images.length > 1) {
        setInterval(() => {
          // Imagen actual se desvanece
          const currentImg = images[currentIndex];
          currentImg.classList.remove('opacity-100', 'z-10');
          currentImg.classList.add('opacity-0', 'z-0');

          // Siguiente imagen
          currentIndex = (currentIndex + 1) % images.length;
          const nextImg = images[currentIndex];
          
          // La siguiente imagen aparece
          nextImg.classList.remove('opacity-0', 'z-0');
          nextImg.classList.add('opacity-100', 'z-10');
        }, intervalTime);
      }
    }
  </script>
)}

<style>
  /* Optimización de renderizado de la imagen */
  [astro-root] img {
    transform: translateZ(0);
  }
  
  /* Ajuste de posición de la imagen en móviles */
  @media (max-width: 640px) {
    [astro-root] img {
      object-position: center 30%;
    }
  }
</style>